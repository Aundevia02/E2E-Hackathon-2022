<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>directions</title>
    <link rel="stylesheet" href="../static/styles/mapstyle.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <header>
        <h1>ATrack</h1>
    </header>
    <article id="scroll-info">

    </article>

    <section id="directions">

        <p id="directions-info"></p>
        <p id="travel-time"></p>

        <article id="directions-map">map should appear here</article>

    </section>



    <footer>
        <p>&copy; ATrack </p>
    </footer>

    <script>
        console.info('spa_directions.js loaded');

        /* code for simple map */
        const directionsInfo = document.querySelector('#directions-info');
        const directionsButton = document.querySelector('#get-directions');
        const travelTime = document.querySelector('#travel-time');
        const startImage = new Image(100, 100);
        startImage.src = '../static/styles/mapstyle.css/Bear.jpg';
        let directionsService;
        let directionsDisplay;
        var userid = "{{userid}}"
        var cur_lat = {{code_info.lat}}
        var cur_lng = {{code_info.lng}}

        let INTERVAL_TIMER = true
        if (INTERVAL_TIMER) {
        setInterval(updateLoc, 1000);
        }

        function SetMarker(lat, lng) {
          //Remove previous Marker.
          if (marker != null) {
              marker.setMap(null);
          }
          
          var myLatlng = new google.maps.LatLng(lat, lng);
          marker = new google.maps.Marker({
              position: myLatlng,
              map: map,
              title: data.title
          });
  
          //Create and open InfoWindow.
          var infoWindow = new google.maps.InfoWindow();
          infoWindow.setContent("<div style = 'width:200px;min-height:40px'>" + data.description + "</div>");
          infoWindow.open(map, marker);
        };

        window.onload = function (){
          let destination = new google.maps.LatLng(cur_lat, cur_lng);
          //destination = "Bangs Ambulance Operations, New York 79, Ithaca, NY";
          getLocation(destination);
        };
        function getLocation(dest) {

            navigator.geolocation.getCurrentPosition(function(position) {
                //directionsInfo.innerHTML = `The button has been pressed`
                directionsInfo.innerHTML = `Your coordinates: (${position.coords.latitude}, ${position.coords.longitude})`;
                var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                initMap(pos, dest);
            });
        }
        
        function updateLoc() {
          

        }
        

        function initMap(location, destination) {

            // Instantiate a directions service.
            directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
            directionsMap = new google.maps.Map(document.querySelector('#directions-map'), {
                center: location,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                zoom: 16,
                icon: startImage
            });
            //GR added this 2022-06 to suppress A & B markers.
            var rendererOptions = {
                map: directionsMap,
                //draggable: true,
                suppressMarkers: true

            }
            directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
            //end of stuff added

            directionsService = new google.maps.DirectionsService();

            directionsDisplay.setMap(directionsMap);


            calcRoute(location, destination);

        }

        function calcRoute(start, destination) {
            let request = {
                origin: start,
                destination: destination,
                travelMode: google.maps.TravelMode.DRIVING //
            };

            directionsService.route(request, function(response, status) {
                if (status == 'OK') {
                    directionsDisplay.setDirections(response);
                    var point = response.routes[0].legs[0];
                    //$( '#travel_data' ).html( 'Estimated travel time: ' + point.duration.text + ' (' + point.distance.text + ')' );
                    //travelTime.innerHTML = "\t Estimated Travel Time: " + point.duration.text + "\t Distance: " + point.distance.text;
                    //directionsInfo.innerHTML += "\t Estimated Travel Time: " + point.duration.text + "\t Distance: " + point.distance.text;
                    travelTime.innerHTML = `Estimated Travel Time: ${point.duration.text}, Distance: ${point.distance.text}`;
                    let starter = new google.maps.Marker({
                        position: start,
                        map: directionsMap,
                        label: {
                            text: 'You',
                            color: "#f3f3f3",
                            fontSize: "14px",
                            fontWeight: "bold"
                        }
                    });
                    let end = new google.maps.Marker({
                        position: destination,
                        map: directionsMap,
                        label: {
                            text: 'Amb',
                            color: "#f3f3f3",
                            fontSize: "14px",
                            fontWeight: "bold"
                        }
                    });
                    end.setMap(directionsMap)

                } else {
                    alert("Directions no found: " + status)
                }

            })
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDXc9W874xRGVHWAtpeBcKokoa4VVYeBC8&callback=myMap"></script>

    <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOKsQNZ3FsAta_dB9UhkrUv93M9_Xc3jA" async defer></script> -->


</body>

</html> 
