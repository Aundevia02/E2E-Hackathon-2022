<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>directions</title>
    <link rel="stylesheet" href="../static/styles/mapstyle.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <header>
        <center>
            <span class="title" , id="title" , style="color:#880808">A</span>
            <span class="title" , id="title" , style="color:#fcfbfb">Track</span>
        </center>
    </header>

    <section id="directions">

        <center>
            <p id="travel-time"></p>
            <p id="directions-info"></p>

        </center>

        <article id="directions-map">map should appear here</article>
        <p></p>

        <div id="what">
            <center>
                <h1 id="what_title"> What to do?</h1>
                <p id="med-info"> </p>
                <p id="med-src"></p>
            </center>
        </div>


        <!-- <img src="../static/styles/Bear.png" alt="alternatetext"> -->

    </section>



    <footer>
        <p>&copy; ATrack </p>
    </footer>

    <script>
        med_problems = {

            "Heart Attack": [`<ul>
  <li>Chew and swallow an aspirin while waiting for emergency help. Aspirin helps keep your blood from clotting. When taken during a heart attack, it could reduce heart damage. Don't take aspirin if you are allergic to it or have been told by your health care provider never to take aspirin.</li>
  <li>Take nitroglycerin, if prescribed. If you think you're having a heart attack and your health care provider has previously prescribed nitroglycerin for you, take it as directed while waiting for emergency medical help.</li>
  <li>Begin CPR if the person is unconscious. If the person isn't breathing or you don't find a pulse, begin CPR to keep blood flowing after you call for emergency medical help.

Push hard and fast on the center of the person's chest in a fairly rapid rhythm — about 100 to 120 compressions a minute.</li>
<li>If an automated external defibrillator (AED) is immediately available and the person is unconscious, follow the device instructions for using it.</li>
</ul>`, "Mayo Clinic"],

            "Choking": [`<ul>
  <li>If someone is choking, encourage them to cough.</li>
  <li>Bend them forwards and give up to 5 back blows to try and dislodge the blockage.</li>
  <li>If they are still choking, give up to 5 abdominal thrusts: hold around the waist and pull inwards and upwards above their belly button.</li>
</ul>`, "Red Cross"],

            "Seizure": [`<ul>
  <li>Stay with the person until the seizure ends and he or she is fully awake. After it ends, help the person sit in a safe place. Once they are alert and able to communicate, tell them what happened in very simple terms.</li>
  <li>Keep yourself and other people calm.</li>
  <li>Check to see if the person is wearing a medical bracelet or other emergency information..</li>
</ul>`, "CDC"],

            "Anaphylaxis": [`<ul>
  <li>Ask if the person is carrying an epinephrine autoinjector (EpiPen, Auvi-Q, others) to treat an allergic attack.</li>
  <li>If the person needs to use an autoinjector, ask whether you should help inject the medication. This is usually done by pressing the autoinjector against the person's thigh.</li>
  <li>Have the person lie face up and be still.</li>
<li>Loosen tight clothing and cover the person with a blanket. Don't give the person anything to drink.</li>
<li>If there's vomiting or bleeding from the mouth, turn the person to the side to prevent choking.</li>
<li>If there are no signs of breathing, coughing or movement, begin CPR. Do uninterrupted chest presses — about 100 every minute — until paramedics arrive.</li>
</ul>`, "Mayo Clinic"],
            "Panic Attack": [`<ul>
  <li>Stay calm. Don’t let the situation overrun you. Your low-key behavior can be a model for your friend and let them know everything's OK.</li>
  <li>Stick around. The best thing you can do to help with a panic attack is to stay and help your friend ride it out. Most panic attacks ease up in 20 to 30 minutes.</li>
  <li>Do your best to be understanding, positive, and encouraging. Ask what the cause of your friend's panic is. That can let them take a step back and think about the situation more rationally.</li>
</ul>`, "Web MD"],

            "Fainting": [`<ul>
  <li>Check alertness: Ask things to determine level of orientation. If they become unresponsive, check for pulse, check to see if they're breathing. </li>
  <li>Listen for breathing through the nose, watch the chest for rise and fall. Take a pulse, either at the wrist or neck. If they are breathing and have a pulse, you should stay with them to offer support. </li>
  <li>Start CPR: If the patient isn't breathing and does not have a pulse, start CPR.</li>
<li>Make the patient comfortable: "If this person has been out in the heat, move them to a shady spot. If they're sweating, pour water over their skin," </li>
</ul>`, "WebMD"],

            "Bleeding": [`<ul>
  <li>Apply direct pressure on the cut or wound with a clean cloth, tissue, or piece of gauze until bleeding stops. If blood soaks through the material, don’t remove it. Put more cloth or gauze on top of it and continue to apply pressure.
</li>
  <li>If the wound is on the arm or leg, raise limb above the heart, if possible, to help slow bleeding.
Wash your hands again after giving first aid and before cleaning and dressing the wound.
Do not apply a tourniquet unless the bleeding is severe and not stopped with direct pressure.
 </li>
  <li>Gently clean with soap and warm water. Try to rinse soap out of wound to prevent irritation.
Don’t use hydrogen peroxide or iodine, which can damage tissue.
</li>
</ul>`, "WebMD"],

            "Burns": [`<ul>
  <li>Step away from the source of the burn.</li>
  <li>Gently flush the area with cool water to reduce the temperature. Never use ice </li>
  <li>Remove clothing from the wound unless it's sticking; in that case, leave it for medical professionals to remove. Take off any jewelry before the area can swell. </li>
<li>Cover the burn with a clean cloth or a gauze pad if you have it.</li>
<li>Do not use any greases, sprays, butter, or ointments on a burn, as they keep the heat in.</li>

</ul>`, "verywellhealth"],

            "Accidental Amputation": [`<ul>
  <li>Have the injured person lie down, if possible, and elevate the injured area.
</li>
  <li>If the wound is on the arm or leg, raise limb above the heart, if possible, to help slow bleeding.
</li>
<li>
If blood soaks through, apply another covering over the first one. Don’t take the first one off.
Use a tourniquet or compression bandage only if bleeding is severe and not stopped with direct pressure. Wrap or cover the injured area with sterile dressing or clean cloth.
 </li>
  <li>Cover with coat or blanket.
Calm the person as much as possible until medical help arrives. 
</li>
<li>In some cases, the amputated part can be reattached.If possible, rinse with clean water to remove dirt or debris. Do not use soap or scrub.
Place in a clean, plastic bag.
Pack the bag in ice. Take it with you to the hospital.
</li>
</ul>`, "WebMD"],


            "Sprains": [`<ul>
  <li>make sure that the injured person stops any unnecessary activity, as moving can make the injury worse.</li>
  <li>Keep the limb as still as possible and avoid a cold pack</li>
  <li>Elevate the injured part if you can do so safely and use NSAIDs for pain.</li>
<li>Ask your provider about any other treatment for a sprain you might need.</li>

</ul>`, "verywellhealth"],


            "Drug Overdose": [`<ul>
  <li>Begin CPR, if Necessary. If the person is not breathing or breathing is dangerously weak. Do uninterrupted chest presses — about 100 every minute — until paramedics arrive.</li>
  <li>Call Poison Control at 800-222-1222 (in U.S.) even if the person has no symptoms. Poison Control experts will advise you how to proceed. Do not try to make the person vomit or give the person anything to eat or drink.
 </li>
  <li>Give drug or pills the person may have taken to the emergency team, or take them to the emergency room or doctor's office. </li>
<li>At the hospital, the person's stomach may be pumped. Activated charcoal may be given by mouth to absorb the drug.
</li>
</ul>`, "Web MD"]


        }

        function getProcedure() {
            var keys = Object.keys(med_problems)
            problem = keys[Math.floor(Math.random() * keys.length)];
            document.getElementById('what_title').innerHTML = "What To Do? (" + problem + ")";
            document.getElementById('med-info').innerHTML = med_problems[problem][0];
            document.getElementById('med-src').innerHTML = "~ " + med_problems[problem][1];
        }

        const directionsInfo = document.querySelector('#directions-info');
        const directionsButton = document.querySelector('#get-directions');
        const travelTime = document.querySelector('#travel-time');

        let directionsService;
        let directionsDisplay;
        var userid = "{{userid}}"
        var lats = [42.43898878,
            42.43839994,
            42.4397739,
            42.44028913,
            42.44043633,
            42.4404854,
            42.44054865,
            42.44053282,
            42.4406595,
            42.44265471,
            42.44411149,
            42.44590075,
            42.44556824,
            42.44515655
        ]
        var lngs = [-76.50160623, -76.50107431, -76.50173922, -76.50137352, -76.5003429, -76.49884686, -76.49453227, -76.49270837, -76.49002616, -76.48981158, -76.4894468, -76.48785894, -76.48614232, -76.48273055]
        var types = "{{types}}"
        var counter = 0

        var cur_lat = lats[counter]
        var cur_lng = lngs[counter]
        counter += 1
        let INTERVAL_TIMER = true

        function updateLoc() {
            var new_lat = lats[counter]
            var new_lng = lngs[counter]

            if (counter < lats.length) {
                counter += 1
            } else {
                clearInterval(interval)
            }

            SetMarker(new_lat, new_lng)
        }

        var map;
        var marker;
        var my_pos;

        if (INTERVAL_TIMER) {
            const interval = setInterval(updateLoc, 2000);
        }


        function SetMarker(lat, lng) {
            //Remove previous Marker.
            if (marker != null) {
                marker.setMap(null);
            }

            var myLatlng = new google.maps.LatLng(lat, lng);
            marker = new google.maps.Marker({
                position: myLatlng,
                map: map,
                title: "ambulance",
                label: {
                    text: 'A',
                    color: "#f3f3f3",
                    fontSize: "14px",
                    fontWeight: "bold"
                }
            });
            marker.setMap(map)
            let destination = new google.maps.LatLng(lat, lng);

            calcRoute(my_pos, destination);

            //Create and open InfoWindow.

        };

        window.onload = function() {
            let destination = new google.maps.LatLng(cur_lat, cur_lng);
            //destination = "Bangs Ambulance Operations, New York 79, Ithaca, NY";
            getLocation(destination);
        };

        function getLocation(dest) {

            navigator.geolocation.getCurrentPosition(function(position) {
                //directionsInfo.innerHTML = `The button has been pressed`
                directionsInfo.innerHTML = `Your coordinates: (${position.coords.latitude}, ${position.coords.longitude})`;
                var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                my_pos = pos
                initMap(pos, dest);
            });
        }



        function initMap(location, destination) {


            directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);
            directionsMap = new google.maps.Map(document.querySelector('#directions-map'), {
                center: location,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                zoom: 16,
            });
            marker = new google.maps.Marker({
                position: destination,
                map: directionsMap,
                label: {
                    text: 'A',
                    color: "#f3f3f3",
                    fontSize: "14px",
                    fontWeight: "bold"
                }
            });


            var rendererOptions = {
                map: directionsMap,
                //draggable: true,
                suppressMarkers: true

            }
            directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);


            directionsService = new google.maps.DirectionsService();

            directionsDisplay.setMap(directionsMap);


            calcRoute(location, destination);
            map = directionsMap

        }

        function calcRoute(start, destination) {
            let request = {
                origin: start,
                destination: destination,
                travelMode: google.maps.TravelMode.DRIVING //
            };

            directionsService.route(request, function(response, status) {
                if (status == 'OK') {
                    directionsDisplay.setDirections(response);
                    var point = response.routes[0].legs[0];
                    travelTime.innerHTML = `Estimated Travel Time: ${point.duration.text}, Distance: ${point.distance.text}`;
                    let starter = new google.maps.Marker({
                        position: start,
                        map: directionsMap,
                        label: {
                            text: 'You',
                            color: "#f3f3f3",
                            fontSize: "14px",
                            fontWeight: "bold"
                        }
                    });

                } else {
                    alert("Directions not found: " + status)
                }

            })

            getProcedure();
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDXc9W874xRGVHWAtpeBcKokoa4VVYeBC8&callback=myMap"></script>

    <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOKsQNZ3FsAta_dB9UhkrUv93M9_Xc3jA" async defer></script> -->


</body>

</html>